<script>
	import FilterIcon from '../../lib/icons/FilterIcon.svelte';
	import SearchIcon from '../../lib/icons/SearchIcon.svelte';
	import Title from '../../lib/Title/Title.svelte';
	import ModalOpener from '../../lib/Modal/ModalOpener.svelte';
	import ModuleList from './ModuleList.svelte';
	import FilterModal from './FilterModal.svelte';
	import SubtleXIcon from '../../lib/icons/SubtleXIcon.svelte';
	import { getModulesBySearch } from '../api/calls';

	let filters = [];
	export let data;

	let modules;
	let availableFilters;
	$: modules = data.modules;
	$: availableFilters = data.availableFilters;

	let filterModal;

	let searchQuery = "";

	let modulesComponent;

	function updateModules() {
		modulesComponent.update();
	}

	function remove(filter) {
		filterModal.remove(filter);
	}

</script>

<Title title="Ãœbersicht" />

<section class="w-full max-w-lg">

	<div class="flex gap-2">
		<!-- Searchbar -->
		<div class="form-control flex-1">
			<div class="input-group">
				<input type="text" placeholder="Suche..." class="input input-bordered w-full"
					   bind:value={searchQuery} on:keypress={e => e.key === 'Enter' && updateModules()}/>
				<button class="btn btn-square" on:click={updateModules}>
					<SearchIcon />
				</button>
			</div>
		</div>

		<!-- Filter Button -->
		<ModalOpener class="btn" name="filter-modal">
			<FilterIcon />
		</ModalOpener>

	</div>

	<!-- Filter Badges -->
	<ul class="flex gap-2 mt-2">
		{#each filters as filter}
			{#if !filter.default}
				<li class="badge badge-secondary gap-2">
					<button class="cursor-pointer flex items-center" on:click={() => remove(filter)}>
						<SubtleXIcon />
					</button>

					{filter.short}
				</li>
			{/if}
		{/each}
	</ul>

	<br />

	<!-- Modules -->
	<ModuleList bind:this={modulesComponent} {searchQuery} {filters} />

</section>

<FilterModal bind:this={filterModal} bind:filters {availableFilters} />
